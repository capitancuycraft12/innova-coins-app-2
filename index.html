<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Innova Coins - Sistema Escolar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-gray-100">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function App() {
            // ESTA ES LA URL DE TU APLICACIN WEB DE GOOGLE (IMAGEN image_036ccf.png)
            const API_URL = 'https://script.google.com/macros/s/AKfycbypY4R4EbcdGyWKsqAMDJFCqChpuKx2VuHxfxeawcLu26Tl3E21TzEgEykax_4RH0_Q1A/exec';
            
            const [view, setView] = useState('registro');
            const [students, setStudents] = useState([]);
            const [loading, setLoading] = useState(false);

            // Funci贸n para obtener la lista de estudiantes
            const fetchStudents = async () => {
                setLoading(true);
                try {
                    const response = await fetch(API_URL);
                    const data = await response.json();
                    if (data.success) {
                        setStudents(data.students);
                    }
                } catch (error) {
                    console.error("Error de lectura:", error);
                }
                setLoading(false);
            };

            useEffect(() => {
                if (view === 'lista') fetchStudents();
            }, [view]);

            // Funci贸n para registrar nuevo alumno
            const handleRegister = async (e) => {
                e.preventDefault();
                setLoading(true);
                const nombre = e.target.nombre.value;
                const grado = e.target.grado.value;

                try {
                    // Usamos mode: 'no-cors' para evitar bloqueos de permisos de Google
                    await fetch(API_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        body: new URLSearchParams({
                            action: 'registro',
                            nombre: nombre,
                            grado: grado
                        })
                    });
                    alert('隆Registro enviado con 茅xito! Revisa tu Google Sheet.');
                    e.target.reset();
                } catch (error) {
                    alert('Hubo un error al enviar el registro.');
                }
                setLoading(false);
            };

            return (
                <div className="min-h-screen font-sans">
                    <header className="bg-blue-700 text-white p-6 shadow-md text-center">
                        <h1 className="text-2xl font-bold tracking-wider">INNOVA COINS 2026</h1>
                    </header>

                    <nav className="flex justify-around bg-white shadow-sm mb-6">
                        <button onClick={() => setView('registro')} className={`p-4 w-1/2 font-bold ${view === 'registro' ? 'text-blue-600 border-b-4 border-blue-600' : 'text-gray-400'}`}>REGISTRO</button>
                        <button onClick={() => setView('lista')} className={`p-4 w-1/2 font-bold ${view === 'lista' ? 'text-blue-600 border-b-4 border-blue-600' : 'text-gray-400'}`}>ESTUDIANTES</button>
                    </nav>

                    <main className="max-w-md mx-auto px-4">
                        {view === 'registro' ? (
                            <div className="bg-white p-8 rounded-2xl shadow-lg border border-gray-200">
                                <h2 className="text-xl font-bold text-gray-800 mb-2 text-center">Inscripci贸n</h2>
                                <p className="text-gray-500 text-sm text-center mb-6">Crea tu cuenta para empezar a ganar coins.</p>
                                <form onSubmit={handleRegister} className="space-y-4">
                                    <input name="nombre" type="text" placeholder="Tu nombre completo" className="w-full p-3 border rounded-xl focus:ring-2 focus:ring-blue-500 outline-none" required />
                                    <input name="grado" type="text" placeholder="Grado y Secci贸n" className="w-full p-3 border rounded-xl focus:ring-2 focus:ring-blue-500 outline-none" required />
                                    <button type="submit" className="w-full bg-blue-600 text-white py-3 rounded-xl font-bold hover:bg-blue-700 transition shadow-lg">REGISTRARME</button>
                                </form>
                            </div>
                        ) : (
                            <div className="space-y-4">
                                <h2 className="text-lg font-bold text-gray-700 ml-2">Lista de Alumnos</h2>
                                {students.length === 0 && !loading && <p className="text-center text-gray-400">No hay estudiantes registrados a煤n.</p>}
                                {students.map((s, index) => (
                                    <div key={index} className="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex justify-between items-center transform hover:scale-[1.02] transition">
                                        <div>
                                            <p className="font-bold text-gray-800 uppercase text-sm">{s.name}</p>
                                            <p className="text-xs text-gray-400">{s.grade}</p>
                                        </div>
                                        <div className="text-right">
                                            <span className="text-2xl font-black text-yellow-600 leading-none">{s.balance}</span>
                                            <p className="text-[10px] font-bold text-gray-400">COINS</p>
                                        </div>
                                    </div>
                                ))}
                                <button onClick={fetchStudents} className="w-full py-4 text-blue-500 text-sm font-semibold"> Actualizar datos</button>
                            </div>
                        )}
                    </main>

                    {loading && (
                        <div className="fixed inset-0 bg-white/70 backdrop-blur-sm flex flex-col items-center justify-center z-50">
                            <div className="w-10 h-10 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mb-2"></div>
                            <p className="text-blue-600 font-bold">Conectando con Google...</p>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
